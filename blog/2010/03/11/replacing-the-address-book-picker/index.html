<!doctype html><html><head><meta charset=utf-8><meta name=keywords content><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-4573209-2","auto"),ga("send","pageview"))</script><meta name=robots content="index,follow"><link rel=stylesheet href=https://noverse.com/css/main.css><link rel=stylesheet href=https://noverse.com/css/all.css><link rel=stylesheet href=https://noverse.com/css/carbon.css><link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic,700italic' rel=stylesheet type=text/css><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script><title>Replacing the Address Book Picker</title></head><body><div id=container><header id=header><img id=logo src=https://noverse.com/images/noverse-logo.png><h2 id=sub-title>Software and advice that's not of this verse</h2></header><nav id=menu><ul><li><a href=https://noverse.com/about/ title="about me">About</a></li><li><a href=https://noverse.com/ title="blog section">Blog</a></li><li><a href=https://noverse.com/services title="services section">Services</a></li><li><a href=https://noverse.com/archives/ title="archives section">Archives</a></li></ul></nav><section id=content><p class=meta-data><span class=post-date>Mar 11, 2010 12:56 PM</span></p><div class=tag-group><div class=tag><span class=tag-text>| <a href=https://noverse.com/tags/software-designer>Software Designer</a></span></div><div class=tag><span class=tag-text>| <a href=https://noverse.com/tags/tools-and-techniques>Tools and Techniques</a></span></div></div><h1 class=post-title>Replacing the Address Book Picker</h1><div class=post-body><p>In the first release of Emergency List, I used the default <code>ABPeoplePickerNavigationController</code> to allow users to add emergency contacts from their iPhone Address Book. Real users found it confusing, so I wrote my own.</p><h3 id=whats-wrong-with-the-apple-implementation>What&rsquo;s wrong with the Apple implementation?</h3><p>The requirement is for the user to pick a phone number for a contact.</p><p>The implementation requires you to launch an address book picker which displays a list of contact names - just the names and nothing else. To enable the user to pick a phone number, you need to return <code>NO</code> to <code>â€“ peoplePickerNavigationController: shouldContinueAfterSelectingPerson:</code> so that the picker displays details of that contact when the user taps it. You also need to set <code>displayedProperties</code> to phone numbers only so only numbers appear in the details of that contact. The user can then tap a phone number to add it to my app.</p><p>So, the user has to tap a name then tap a number <em>on the next view</em> that comes up. Two taps on two views to pick a phone number.</p><p>Seems simple but most users wondered why they got the second view when they tapped a name. Surely they could just tap a name and the number would be used.</p><h3 id=solution-1--just-use-the-list-of-names>Solution 1: Just use the list of names</h3><p>Simple, I thought. Launch the picker and allow the user to pick a name. As soon as the user taps the name, return. If the selected address book record has one and only one phone number, use it. Otherwise give the user a list of numbers to pick on an alert sheet and we&rsquo;re good to go.</p><p>I did not like this solution because</p><ul><li>It still required two views in most cases to pick contact numbers - the picker and the alert</li><li>What if the contact had no phone numbers - an email only contact?</li><li>What if the user changed their minds between picking the person and choosing the number. Using the default picker behavior above, they could hit the back button. Not so with the picker gone and an alert being shown.</li></ul><h3 id=solution-2-create-a-table-view-with-names-and-numbers>Solution 2: Create a table view with names and numbers</h3><p>Sounds better. Get all address book entries, build a list of names and numbers and allow the user to pick them off a simple table view with names on the left and numbers on the right.</p><p>I liked this better because:</p><ul><li>Single tap to pick a number that you can see</li><li>I can filter out contacts with no numbers</li></ul><p>So I created it. I started with an array of 26 arrays, one for each letter of the alphabet. I then looped through the address book, and if the contact had a number, would add that contact and each number and its category (home, mobile, work) to the correct letter array. I then sort each letter array using the last name of each contact. I based a standard <code>UITableView</code> on this data structure, showing names and categories on the left and numbers on the right, separated by letter sections, and even added an index to make finding names quicker. Like so:</p><figure><img src=images/NewAddressPicker.png width=200 height=288></figure><p>But it was not as easy as that, and I found that out the hard way, when beta testers and real users sent crash logs:</p><ul><li>Turns out that lots of contacts had no contact name. Several people just input an email address on a contact and remember that. When this happens, <code>ABRecordCopyCompositeName</code> returns <code>nil</code> and when <code>nil</code> is passed to <code>NSString stringWithString:</code>, it crashes. So I had to use a default &ldquo;No Name&rdquo; in this case, just like Address Book on the Mac does.</li><li>Turns out, lots of contact names are not written in roman characters. Which bucket, then, does the name belong in on a roman alphabet index? Solution, foreign character names go into the last or &ldquo;Z&rdquo; bucket, just like Address Book on the Mac. I did not implement a &ldquo;#&rdquo; bucket for numeric names either.</li><li>Turns out not all address books have names in all 26 categories. It really looks ugly when there are two section headings and nothing between them. So I had to modify the sectional data structure to skip out empty sections. I also then had to create a mapping table between the index and valid sections. So when the user taps an index item where the section was blank, the view goes to the previous section.</li><li>Turns out, not all address book phone numbers have good categories. Sometimes the type is <code>nil</code> or garbage, causing crashes. So now I recognize the standard types and ignore all others. For example, I recognize Kate Bell&rsquo;s mobile number &ldquo;(M)&rdquo; but not the other number&rsquo;s category.</li></ul><p>So there it is, my phone number picker.</p></div><p class=post-mark><span class="fas fa-envelope"></span>
<span>Posted By Hiltmon</span>
&#183;
<span class="fas fa-clock"></span>
<span>Mar 11, 2010 12:56 PM</span></p><div class=pagination><ul><li class=post-previous><a href=https://noverse.com/blog/2010/04/04/ipad-first-impressions/>&larr; iPad First Impressions</a></li><li class=post-center>&nbsp;</li><li class=post-next><a href=https://noverse.com/blog/2010/03/03/how-to-deal-with-an-iphone-crash-report/>How to deal with an iPhone crash report &rarr;</a></li></ul></div></section><aside id=sidebar><section><h1>About Noverse LLC</h1><p>Noverse is a New York independent software designer and developer, established in 2010 by Hilton Lipschitz (<a href=https://hiltmon.com>@hiltmon</a>) to provide <em>experienced</em> consulting and development services for Hedge Funds, and to craft brilliant web, iOS and Macintosh software.</p><p><strong>For more recent writing, go to Hilton's public web site at <a href=https://hiltmon.com>hiltmon.com</a>.</strong></p><p><a href=https://noverse.com/contact>Contact</a> |
<a href=https://noverse.com/about>About</a> |
<a href=https://noverse.com/portfolio>Portfolio</a><p></section><section><h1>Recent Posts</h1><ul><li><a class=sidebar-link href=https://noverse.com/blog/2013/05/12/hiltmonisms-for-hedge-funds/>Hiltmonisms for Hedge Funds</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2013/05/06/a-hedge-fund-technology-architecture/>A Hedge Fund Technology Architecture</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2013/05/04/the-opportunity/>The Opportunity</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2013/02/07/timetocall-released-to-the-app-store/>TimeToCall Released to the App Store</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2013/01/25/time-to-call-coming-soon/>Time To Call - Coming Soon</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2013/01/14/hit-by-a-bus/>Hit by a Bus</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2012/12/29/thank-you-for-2012/>Thank You for 2012</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2012/10/16/doing-software-demos-right/>Doing Software Demos Right</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2012/10/05/the-hedge-fund-cto-role/>The Hedge Fund CTO Role</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2012/07/12/kifu-v1-dot-0-released/>Kifu v1.0 Released</a></li></ul><section></aside><footer id=footer><p>Copyright &copy; 2022 Hilton Lipschitz</p></footer></div></body></html>