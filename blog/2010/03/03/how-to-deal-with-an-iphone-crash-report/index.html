<!doctype html><html><head><meta charset=utf-8><meta name=keywords content><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script async src="https://www.googletagmanager.com/gtag/js?id=G-5DB0RK2CLR"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5DB0RK2CLR",{anonymize_ip:!1})}</script><meta name=robots content="index,follow"><link rel=stylesheet href=https://noverse.com/css/main.css><link rel=stylesheet href=https://noverse.com/css/all.css><link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic,700italic' rel=stylesheet type=text/css><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script><title>How to deal with an iPhone crash report</title></head><body><div id=container><header id=header><img id=logo src=https://noverse.com/images/noverse-logo.png><h2 id=sub-title>Software and advice that's not of this verse</h2></header><nav id=menu><ul><li><a href=https://noverse.com/about/ title="about me">About</a></li><li><a href=https://noverse.com/ title="blog section">Blog</a></li><li><a href=https://noverse.com/services title="services section">Services</a></li><li><a href=https://noverse.com/archives/ title="archives section">Archives</a></li></ul></nav><section id=content><p class=meta-data><span class=post-date>Mar 3, 2010 10:37 PM</span></p><div class=tag-group><div class=tag><span class=tag-text>| <a href=https://noverse.com/tags/software-designer>Software Designer</a></span></div><div class=tag><span class=tag-text>| <a href=https://noverse.com/tags/tools-and-techniques>Tools and Techniques</a></span></div></div><h1 class=post-title>How to deal with an iPhone crash report</h1><div class=post-body><p>Kudos to the app review team at Apple, they found a crasher in the update to Emergency List that I recently submitted. They even took the time to step through and document what they did exactly to reproduce the error.</p><p>From their email:</p><pre><code>1. Launch app connected to a network
2. Tap Emergency List
3. Tap the Add button
4. Tap Add from Address Book
5. App crashes

Please refer to the attached crash logs.
</code></pre><p>They even sent two crash logs to help find the problem.</p><h3 id=reading-the-crash-logs>Reading the Crash Logs</h3><p>The crash logs by themselves are very difficult to read. Below is a segment:</p><pre><code>Thread 0 Crashed:
0   libSystem.B.dylib             	0x3293f98c 0x328c1000 + 518540
1   libSystem.B.dylib             	0x3293f97c 0x328c1000 + 518524
2   libSystem.B.dylib             	0x3293f96e 0x328c1000 + 518510
3   libSystem.B.dylib             	0x3295461a 0x328c1000 + 603674
4   libstdc++.6.dylib             	0x30a143b0 0x309cf000 + 283568
5   libobjc.A.dylib               	0x3347a858 0x33475000 + 22616
6   libstdc++.6.dylib             	0x30a12776 0x309cf000 + 276342
7   libstdc++.6.dylib             	0x30a127ca 0x309cf000 + 276426
8   libstdc++.6.dylib             	0x30a12896 0x309cf000 + 276630
9   libobjc.A.dylib               	0x33479714 0x33475000 + 18196
10  CoreFoundation                	0x3355ab86 0x33534000 + 158598
11  CoreFoundation                	0x3355ab24 0x33534000 + 158500
12  Foundation                    	0x326cf9ae 0x3267e000 + 334254
13  Foundation                    	0x32685760 0x3267e000 + 30560
14  EmergencyNumbers              	0x0000641c 0x1000 + 21532
15  EmergencyNumbers              	0x000060d2 0x1000 + 20690
16  UIKit                         	0x31c63aa4 0x31c17000 + 314020
17  UIKit                         	0x31c7aec0 0x31c17000 + 409280
18  UIKit                         	0x31c7ace0 0x31c17000 + 408800
19  UIKit                         	0x31c7abde 0x31c17000 + 408542
20  UIKit                         	0x31c7a784 0x31c17000 + 407428
21  UIKit                         	0x31c7a59c 0x31c17000 + 406940
22  UIKit                         	0x31c7a4e0 0x31c17000 + 406752
23  UIKit                         	0x31c65df4 0x31c17000 + 323060
24  UIKit                         	0x31c4a574 0x31c17000 + 210292
25  QuartzCore                    	0x30039004 0x30030000 + 36868
26  QuartzCore                    	0x30038e1c 0x30030000 + 36380
27  QuartzCore                    	0x3003893c 0x30030000 + 35132
28  QuartzCore                    	0x300386a2 0x30030000 + 34466
29  QuartzCore                    	0x3003e02a 0x30030000 + 57386
30  CoreFoundation                	0x33543b50 0x33534000 + 64336
31  CoreFoundation                	0x3358aa32 0x33534000 + 354866
32  CoreFoundation                	0x3358a356 0x33534000 + 353110
33  GraphicsServices              	0x3352bb2c 0x33528000 + 15148
34  GraphicsServices              	0x3352bbd8 0x33528000 + 15320
35  UIKit                         	0x31c19768 0x31c17000 + 10088
36  UIKit                         	0x31c1846c 0x31c17000 + 5228
37  EmergencyNumbers              	0x000020b4 0x1000 + 4276
38  EmergencyNumbers              	0x00002070 0x1000 + 4208
</code></pre><p>All I can read from this is that lines 14 and 15 above in the stack trace is where the crash happened in MY code. But what does 0x0000641c mean?</p><p>Fortunately, I had the dSYM file for the release that they reviewed handy. I ran the following command against it:</p><pre><code>dwarfdump --lookup 0x0000641c -arch armv6 EmergencyNumbers.app.dSYM
</code></pre><p>This command would tell me at what line the app failed. And here it is:</p><pre><code>Line table file: 'AddressBookLookupTableViewController.m' line 60, 
column 0 with start address 0x000000000000641a
</code></pre><h3 id=determining-the-cause-of-the-crash>Determining the cause of the Crash</h3><p>Going to that file and line in the source code reveals:</p><pre tabindex=0><code>CFStringRef cfName = ABRecordCopyCompositeName(person);
aName = [NSString stringWithString:(NSString *)cfName];
CFRelease(cfName);
</code></pre><p>So the crash is happening in the <code>NSString stringWithString</code>. If <code>cfName</code> is equal to nil, this line of code will crash.</p><h3 id=understanding-the-error>Understanding the Error</h3><p>But this error makes no sense to me. In line 59, <code>cfName</code> is populated with the composite name from a valid address book record (person is not nil). According to Apple&rsquo;s reference documentation, ABRecordCopyCompositeName returns:</p><pre><code>For group records: The value of the group name property
	(kABGroupNameProperty).
For person records: The concatenated value of these properties:
	Prefix, Suffix, Organization, First name, and Last name.
</code></pre><p>I just assumed that all contact records in the address book would actually have a name of some kind. <em>And I was wrong!</em> It turns out that it is possible to create address book entries with none of the above fields filled in. And my code should support that.</p><h3 id=the-fix>The Fix</h3><p>Easy. If <code>cfName</code> is <code>nil</code>, use a default name called &ldquo;No Name&rdquo;, just like the address book on Mac OS X. I noticed that the iPhone address book works differently in that it has a cascade of which fields it shows before coming up with &ldquo;No Name&rdquo;, but that is not necessary for my app.</p><pre tabindex=0><code>// It is possible for address books to have no name entries
CFStringRef cfName = ABRecordCopyCompositeName(person);
if (cfName != nil)
{
	aName = [NSString stringWithString:(NSString *)cfName];
	CFRelease(cfName);
}
else
{
	aName = @&#34;No Name&#34;;
}
</code></pre><h3 id=lessons-learned>Lessons Learned</h3><ul><li>Always save the dSYM file from each release so that you can drill on crash reports.</li><li>Always save a snapshot of each release version in source code control so you can pull out the right code base to match the crash report.</li><li>Watch out for assumptions when writing code. I assumed all address book contacts would have names. I was wrong!</li></ul><p>Once again, thanks Apple Review People for catching this.</p></div><p class=post-mark><span class="fas fa-envelope"></span>
<span>Posted By Hiltmon</span>
&#183;
<span class="fas fa-clock"></span>
<span>Mar 3, 2010 10:37 PM</span></p><div class=pagination><ul><li class=post-previous><a href=https://noverse.com/blog/2010/03/11/replacing-the-address-book-picker/>&larr; Replacing the Address Book Picker</a></li><li class=post-center>&nbsp;</li><li class=post-next><a href=https://noverse.com/blog/2010/03/02/emergency-list-finishing-touches/>Emergency List - Finishing Touches &rarr;</a></li></ul></div></section><aside id=sidebar><section><h1>About Noverse LLC</h1><p>Noverse is a New York independent software designer and developer, established in 2010 by Hilton Lipschitz (<a href=https://hiltmon.com>@hiltmon</a>) to provide <em>experienced</em> consulting and development services for Asset Managers, and to craft brilliant web, iOS and Macintosh software.</p><p><strong>For more recent writing, go to Hilton's public web site at <a href=https://hiltmon.com>hiltmon.com</a>.</strong></p><p><a href=https://noverse.com/contact>Contact</a> |
<a href=https://noverse.com/about>About</a> |
<a href=https://noverse.com/portfolio>Portfolio</a><p></section><section><h1>Recent Posts</h1><ul><li><a class=sidebar-link href=https://noverse.com/blog/2013/05/12/hiltmonisms-for-hedge-funds/>Hiltmonisms for Hedge Funds</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2013/05/06/a-hedge-fund-technology-architecture/>A Hedge Fund Technology Architecture</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2013/05/04/the-opportunity/>The Opportunity</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2013/02/07/timetocall-released-to-the-app-store/>TimeToCall Released to the App Store</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2013/01/25/time-to-call-coming-soon/>Time To Call - Coming Soon</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2013/01/14/hit-by-a-bus/>Hit by a Bus</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2012/12/29/thank-you-for-2012/>Thank You for 2012</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2012/10/16/doing-software-demos-right/>Doing Software Demos Right</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2012/10/05/the-hedge-fund-cto-role/>The Hedge Fund CTO Role</a></li><li><a class=sidebar-link href=https://noverse.com/blog/2012/07/12/kifu-v1-dot-0-released/>Kifu v1.0 Released</a></li></ul><section></aside><footer id=footer><p>Copyright &copy; 2022 Hilton Lipschitz</p></footer></div></body></html>